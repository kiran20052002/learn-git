<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Details</title>
    <link rel="stylesheet" href="usercreation.css" />
    <script>
        function toggleSingerOptions() {
            var role = document.querySelector('input[name="role"]:checked').value;
            var singerField = document.getElementById("singer-options");
            singerField.style.display = role === "Singer" ? "block" : "none";
        }

        // Autofill function
        async function autofillUserData() {
            try {
                const response = await fetch("/api/user/profileDetails", {
                    method: "GET",
                    credentials: "include" // Include cookies for session authentication
                });

                if (response.ok) {
                    const data = await response.json();

                    // Autofill fields with user data
                    document.getElementById("username").value = data.username || ""; // Username
                    document.getElementById("firstName").value = data.firstName || ""; // First Name
                    document.getElementById("lastName").value = data.lastName || ""; // Last Name
                    document.getElementById("email").value = data.email || ""; // Email

                    // Handle song styles
                    if (data.songStyles) {
                        const styles = data.songStyles.split(","); // Assuming it's a comma-separated string
                        const songStyleSelect = document.getElementById("songStyle");
                        for (let option of songStyleSelect.options) {
                            if (styles.includes(option.value)) {
                                option.selected = true;
                            }
                        }
                    }

                    // Handle music preferences
                    if (data.musicPreferences) {
                        const preferences = data.musicPreferences.split(","); // Assuming it's a comma-separated string
                        const checkboxes = document.querySelectorAll("input[name='musicPreferences']");
                        checkboxes.forEach(checkbox => {
                            checkbox.checked = preferences.includes(checkbox.value);
                        });
                    }

                    // Handle role selection
                    if (data.role) {
                        document.querySelector(`input[name="role"][value="${data.role}"]`).checked = true;
                        toggleSingerOptions(); // Call to toggle singer options based on role
                    }

                    // Handle songs
                    document.getElementById("songs").value = data.songs || ""; // Songs field
                } else {
                    console.error("Failed to fetch user profile:", response.statusText);
                }
            } catch (error) {
                console.error("Error fetching user profile:", error);
            }
        }

        // Call autofillUserData on page load
        document.addEventListener("DOMContentLoaded", autofillUserData);
    </script>
</head>
<body>
    <div class="container">
        <h2>Complete Your Profile</h2>
        <form action="/register" method="post">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required />

            

            <label for="firstName">First Name:</label>
            <input type="text" id="firstName" name="firstName" required />

            <label for="lastName">Last Name:</label>
            <input type="text" id="lastName" name="lastName" required />

            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required />

            <label for="songStyle">Preferred Song Styles:</label>
            <select id="songStyle" name="songStyles" multiple required>
                <option value="Hip-Hop">Hip-Hop</option>
                <option value="Rap">Rap</option>
                <option value="RnB">R&B</option>
                <option value="Pop">Pop</option>
                <option value="Trap">Trap</option>
            </select>

            <label for="musicPreferences">Music Preferences:</label>
            <div class="checkbox-group">
                <label><input type="checkbox" name="musicPreferences" value="Freestyle" /> Freestyle</label>
                <label><input type="checkbox" name="musicPreferences" value="Lyrical" /> Lyrical</label>
                <label><input type="checkbox" name="musicPreferences" value="Battle" /> Battle</label>
                <label><input type="checkbox" name="musicPreferences" value="Collaborative" /> Collaborative</label>
            </div>

            <label>Are you a:</label>
            <div class="radio-group">
                <label><input type="radio" name="role" value="Fan" onclick="toggleSingerOptions()" required /> Fan</label>
                <label><input type="radio" name="role" value="Singer" onclick="toggleSingerOptions()" /> Singer</label>
            </div>

            <div id="singer-options" class="hidden-field">
                <label for="songs">Add Your Songs:</label>
                <input type="text" id="songs" name="songs" placeholder="Enter song links or titles" />
                <p class="note">
                    As a singer, you can add your songs and join battles to challenge other MCs!
                </p>
            </div>

            <button type="submit" class="submit-btn">Submit</button>
        </form>
    </div>
</body>
</html>
