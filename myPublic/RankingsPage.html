<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Artist Rankings - Dr. Dre's Studio</title>
    <link rel="stylesheet" href="rankingspage.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Artist Rankings</h1>
        <p>Top performers at Dr. Dre's Studio</p>
      </div>

      <table class="rankings-table">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Artist</th>
            <th>Win Rate</th>
            <th>Wins</th>
            <th>Losses</th>
            <th>Trend</th>
          </tr>
        </thead>
        <tbody id="rankings-body">
          <!-- Data will be populated here -->
        </tbody>
      </table>
    </div>

    <script>
      // Simulate previous win rates in an object to calculate trend
      const previousWinRates = {};

      async function fetchArtists() {
        try {
          const response = await fetch("/api/artists");
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          const artists = await response.json();

          // Sort artists by wins first, then by win rate in case of ties
          artists.sort((a, b) => {
            const winRateA =
              a.losses + a.wins > 0 ? a.wins / (a.wins + a.losses) : 0;
            const winRateB =
              b.losses + b.wins > 0 ? b.wins / (b.wins + b.losses) : 0;
            return b.wins === a.wins ? winRateB - winRateA : b.wins - a.wins;
          });

          updateRankingsTable(artists);
        } catch (error) {
          console.error(
            "There has been a problem with your fetch operation:",
            error
          );
        }
      }

      function updateRankingsTable(artists) {
        const tableBody = document.getElementById("rankings-body");
        tableBody.innerHTML = ""; // Clear existing rows

        artists.forEach((artist, index) => {
          // Calculate current win rate
          const winRate =
            artist.losses + artist.wins > 0
              ? ((artist.wins / (artist.wins + artist.losses)) * 100).toFixed(2)
              : 0;

          // Determine trend based on previous win rate
          const previousRate = previousWinRates[artist.id] || winRate;
          let trend = "neutral";
          if (winRate - previousRate > 5) {
            trend = "up";
          } else if (previousRate - winRate > 5) {
            trend = "down";
          }

          // Update previous win rate for the next comparison
          previousWinRates[artist.id] = winRate;

          // Set trend icon based on calculated trend
          const trendIcon =
            trend === "up"
              ? `<span class="trend-up">⬆️</span>`
              : trend === "down"
                ? `<span class="trend-down">⬇️</span>`
                : `<span>➖</span>`;

          // Create a new row with artist data
          const row = document.createElement("tr");
          row.innerHTML = `
            <td class="rank">${index + 1}</td>
            <td>
              <div class="artist-name">
                

                <img src="./myPublic/${artist.id}.jpg" alt="${artist.name}" class="artist-image">
                <div class="artist-info">
                  <span>${artist.name}</span>
                  <span class="artist-username">${artist.username}</span>
                </div>
              </div>
            </td>
            <td>
              <div class="progress-bar">
                <div class="progress" style="width: ${winRate}%;"></div>
              </div>
              ${winRate}%
            </td>
            <td class="stats-cell wins">${artist.wins}</td>
            <td class="stats-cell losses">${artist.losses}</td>
            <td class="stats-cell trend">${trendIcon}</td>
          `;
          tableBody.appendChild(row);
        });
      }

      // Fetch and update the rankings when the page loads
      document.addEventListener("DOMContentLoaded", fetchArtists);
    </script>
  </body>
</html>
