<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Dre's Studio - Artist Battle</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="mainpage.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo-section">
                <img src="music.png" alt="Logo" class="logo">
                <div class="website-name">Dr. Dre's Studio</div>
            </div>
        </header>

        <div class="search-container">
            <h1>Find Artists to Battle</h1>
            <div class="search-wrapper">
                <input type="text" placeholder="Search for artists..." id="artist-search">
                <button class="search-button">
                    <i class="fas fa-search"></i>
                    Search
                </button>
            </div>
        </div>

        <div class="artists">
            <div class="artist-container">
                <img src="artist2.jpg" alt="Artist 1">
                <p class="artist-name">Artist 1</p>
            </div>
            <div class="artist-container">
                <img src="artist2.jpg" alt="Artist 2">
                <p class="artist-name">Artist 2</p>
            </div>
            <div class="artist-container">
                <img src="artist3.jpg" alt="Artist 3">
                <p class="artist-name">Artist 3</p>
            </div>
            <div class="artist-container">
              <img src="artist2.jpg" alt="Artist 1">
              <p class="artist-name">Artist 1</p>
          </div>
          <div class="artist-container">
            <img src="artist3.jpg" alt="Artist 3">
            <p class="artist-name">Artist 3</p>
        </div>
        <div class="artist-container">
          <img src="artist2.jpg" alt="Artist 1">
          <p class="artist-name">Artist 1</p>
      </div>
      <div class="artist-container">
        <img src="artist3.jpg" alt="Artist 3">
        <p class="artist-name">Artist 3</p>
    </div>
        </div>

        <div class="action-buttons">
            <a href="RankingsPage.html" class="action-button rankings-button" style="text-decoration: none;">
                <i class="fas fa-chart-line"></i>
                Rankings
            </a>
            <a href="ind2.html" class="action-button upload-button" style="text-decoration: none;">
                <i class="fas fa-upload"></i>
                Upload Track
            </a>
            <a href="bg.html" class="action-button vp-button" style="text-decoration: none;">
                <i class="fas fa-fire"></i>
                Battle Ground
            </a>
        </div>
        
    </div>

    <!-- Profile Icon -->
    <div class="profile-icon" onclick="toggleProfileDropdown()">
        <i class="fas fa-user"></i>
    </div>

    <!-- Profile Dropdown -->
    <div class="profile-dropdown" id="profileDropdown">
        <div class="profile-header">
            <img src="prof.png" alt="User Profile Picture" class="profile-image">
            <div class="profile-info">
                <h3 id="user-name"></h3> 
                <p id="user-username"></p> 
            </div>
        </div>
        <ul class="profile-menu">
            <li><a href="mypro.html"><i class="fas fa-user-circle"></i> My Profile</a></li>
            <li><a href="updateProfile.html"><i class="fas fa-edit"></i> Edit Details</a></li>
            <li><a href="#"><i class="fas fa-cog"></i> Settings</a></li>
            <li><a href="loginPage.html" onclick="alert('Are you sure you want to logout?')" onre<i class="fas fa-sign-out-alt"></i> Logout </a></li>
        </ul>
    </div>

    <script>
        
        async function fetchUserProfile() {
    try {
        const response = await fetch("/api/user/profileDetails", {
            method: "GET",
            credentials: "include" // Include cookies for session authentication
        });

        if (response.ok) {
            const data = await response.json();

            // Log the received data for debugging
            console.log("Received user profile data:", data);

            // Check if data is received
            if (!data || !data.firstName) {
                console.log("User profile data is incomplete:", data);
                document.getElementById("user-name").textContent = "Name not available"; // Handle missing name
                document.getElementById("user-username").textContent = "Username not available"; // Handle missing username
                return; // Exit the function if data is incomplete
            }

            // Update the DOM elements with user data
            document.getElementById("user-name").textContent = `${data.firstName} ${data.lastName}`;
            document.getElementById("user-username").textContent = `@${data.username}`;
        } else {
            console.error("Failed to fetch user profile:", response.statusText);
            document.getElementById("user-name").textContent = "Error fetching name"; // Handle fetch error
            document.getElementById("user-username").textContent = "Error fetching username"; // Handle fetch error
        }
    } catch (error) {
        console.error("Error fetching user profile:", error);
        document.getElementById("user-name").textContent = "Error"; // Handle error
        document.getElementById("user-username").textContent = "Error"; // Handle error
    }
}


    // Call fetchUserProfile on page load
    document.addEventListener("DOMContentLoaded", fetchUserProfile);
        function toggleProfileDropdown() {
            var dropdown = document.getElementById("profileDropdown");
            dropdown.classList.toggle("show");
        }



        window.onclick = function(event) {
            if (!event.target.matches('.profile-icon, .profile-icon *')) {
                var dropdowns = document.getElementsByClassName("profile-dropdown");
                for (var i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }
    </script>
</body>
</html>