<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rapper Battle Ground</title>
    <link rel="stylesheet" href="bg.css" />
  </head>
  <body>
    <div class="header">
      <h1>Rapper Battle Ground</h1>
    </div>

    <div class="upload-section">
      <form class="upload-form" id="battle-form">
        <input
          type="text"
          id="rapper1-name"
          placeholder="Rapper 1 Name"
          required
        />
        <input type="file" id="rapper1-audio" accept="audio/*" required />
        <input
          type="text"
          id="rapper2-name"
          placeholder="Rapper 2 Name"
          required
        />
        <input type="file" id="rapper2-audio" accept="audio/*" required />
        
        <button type="submit" class="uploadbattle">Upload Battle</button>
      </form>
    </div>

    <div class="battle-container" id="battles"></div>

    <!-- Timer display -->
    <div class="timer" id="timer">Time Remaining: 60s</div>
    <div class="winner-message" id="winner-message"></div>

    <script>
      let countdown;
      let timeRemaining = 60; // Timer starts at 60 seconds

      function startTimer(battleData) {
        const timerElement = document.getElementById("timer");
        countdown = setInterval(() => {
          timeRemaining--;
          timerElement.textContent = `Time Remaining: ${timeRemaining}s`;

          if (timeRemaining <= 0) {
            clearInterval(countdown);
            displayWinner(battleData);
          }
        }, 1000);
      }

      function displayWinner(battleData) {
        const winnerMessage = document.getElementById("winner-message");
        const winner =
          battleData.votes.rapper1 > battleData.votes.rapper2
            ? battleData.rapper1.name
            : battleData.votes.rapper2 > battleData.votes.rapper1
              ? battleData.rapper2.name
              : "It's a tie!";

        winnerMessage.textContent = `Winner: ${winner}`;
      }

      document
        .getElementById("battle-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const rapper1Name = document.getElementById("rapper1-name").value;
          const rapper1Audio =
            document.getElementById("rapper1-audio").files[0];
          const rapper2Name = document.getElementById("rapper2-name").value;
          const rapper2Audio =
            document.getElementById("rapper2-audio").files[0];
          
          const battleData = {
            rapper1: {
              name: rapper1Name,
              audio: URL.createObjectURL(rapper1Audio),
            },
            rapper2: {
              name: rapper2Name,
              audio: URL.createObjectURL(rapper2Audio),
            },
            
            votes: { rapper1: 0, rapper2: 0 },
          };

          displayBattle(battleData);
          startTimer(battleData); // Start the timer for this battle

          this.reset();
        });

      function displayBattle(battleData) {
        const battleContainer = document.createElement("div");
        battleContainer.classList.add("battle");

        

        const versus = document.createElement("div");
        versus.classList.add("versus");

        const rapper1 = document.createElement("div");
        rapper1.classList.add("rapper");
        rapper1.innerHTML = `
          <img src="https://via.placeholder.com/80" alt="${battleData.rapper1.name}" />
          <h3>${battleData.rapper1.name}</h3>
          <div class="audio-player">
              <audio controls>
                  <source src="${battleData.rapper1.audio}" type="audio/mp3">
                  Your browser does not support the audio tag.
              </audio>
          </div>`;

        const rapper2 = document.createElement("div");
        rapper2.classList.add("rapper");
        rapper2.innerHTML = `
          <img src="https://via.placeholder.com/80" alt="${battleData.rapper2.name}" />
          <h3>${battleData.rapper2.name}</h3>
          <div class="audio-player">
              <audio controls>
                  <source src="${battleData.rapper2.audio}" type="audio/mp3">
                  Your browser does not support the audio tag.
              </audio>
          </div>`;

        versus.appendChild(rapper1);
        versus
          .appendChild(document.createElement("div"))
          .classList.add("vs-badge");
        versus.lastChild.innerText = "VS";
        versus.appendChild(rapper2);

        
        battleContainer.appendChild(versus);

        const interactionSection = document.createElement("div");
        interactionSection.classList.add("interaction-section");

        const voteButtons = document.createElement("div");
        voteButtons.classList.add("vote-buttons");

        const likeBtn = document.createElement("button");
        likeBtn.classList.add("vote-btn", "like-btn");
        likeBtn.innerHTML = `Vote for ${battleData.rapper1.name} <span class="vote-count">(${battleData.votes.rapper1})</span>`;
        likeBtn.onclick = () => {
          battleData.votes.rapper1++;
          updateVoteCounts(battleContainer, battleData);
        };

        const dislikeBtn = document.createElement("button");
        dislikeBtn.classList.add("vote-btn", "dislike-btn");
        dislikeBtn.innerHTML = `Vote for ${battleData.rapper2.name} <span class="vote-count">(${battleData.votes.rapper2})</span>`;
        dislikeBtn.onclick = () => {
          battleData.votes.rapper2++;
          updateVoteCounts(battleContainer, battleData);
        };

        voteButtons.appendChild(likeBtn);
        voteButtons.appendChild(dislikeBtn);
        interactionSection.appendChild(voteButtons);

        const stats = document.createElement("div");
        stats.classList.add("stats");
        stats.innerHTML = `<span>Total Votes: ${battleData.votes.rapper1 + battleData.votes.rapper2}</span>`;
        interactionSection.appendChild(stats);
        battleContainer.appendChild(interactionSection);

        document.getElementById("battles").appendChild(battleContainer);
      }

      function updateVoteCounts(battleContainer, battleData) {
        const likeBtn = battleContainer.querySelector(".like-btn");
        const dislikeBtn = battleContainer.querySelector(".dislike-btn");
        likeBtn.querySelector(".vote-count").textContent =
          `(${battleData.votes.rapper1})`;
        dislikeBtn.querySelector(".vote-count").textContent =
          `(${battleData.votes.rapper2})`;
        const stats = battleContainer.querySelector(".stats span");
        stats.textContent = `Total Votes: ${battleData.votes.rapper1 + battleData.votes.rapper2}`;
      }
    </script>
  </body>
</html>
